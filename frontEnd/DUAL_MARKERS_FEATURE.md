# 双标记地图功能说明

## 功能概述
地图页面现在支持同时显示两个位置标记：
- **我的位置**（蓝色标记）：显示用户当前位置
- **充电站位置**（红色标记）：显示目标充电站位置

## 标记设计

### 我的位置标记（蓝色）
- 颜色：蓝色渐变 (#3B82F6 → #1D4ED8)
- 样式：圆形标记 + 三角形指示器
- 层级：zIndex: 200（显示在上面）
- 图标：📍

### 充电站标记（红色）
- 颜色：红色渐变 (#FF4444 → #CC3333)
- 样式：圆形标记 + 三角形指示器
- 层级：zIndex: 100（显示在下面）
- 图标：🔌

## 显示逻辑

### 1. 只有我的位置
- 自动获取用户当前位置
- 显示蓝色标记
- 地图居中到我的位置
- 缩放级别：18

### 2. 只有充电站位置
- 显示红色充电站标记
- 地图居中到充电站位置
- 缩放级别：18

### 3. 两个位置都有
- 同时显示蓝色和红色标记
- 自动调整地图视野以显示两个标记
- 使用 `setFitView` 确保两个标记都在视野内
- 添加适当的边距（50px）

## 信息卡片显示

### 我的位置信息（上面）
- 背景：白色卡片
- 标识：蓝色圆点
- 内容：位置名称、详细地址、坐标
- 样式：简洁紧凑

### 充电站信息（下面）
- 背景：白色卡片
- 标识：红色圆点
- 内容：站点名称、地址、距离、评分
- 样式：信息丰富

## 技术实现

### 标记管理
```typescript
const myLocationMarkerRef = useRef<any>(null)    // 我的位置标记
const stationMarkerRef = useRef<any>(null)       // 充电站标记
```

### 视野调整
```typescript
const adjustMapView = () => {
  const markers: any[] = []
  if (myLocationMarkerRef.current) markers.push(myLocationMarkerRef.current)
  if (stationMarkerRef.current) markers.push(stationMarkerRef.current)
  
  if (markers.length > 1) {
    // 多个标记：调整视野显示所有标记
    mapRef.current.setFitView(markers, false, [50, 50, 50, 50])
  } else {
    // 单个标记：居中显示
    const marker = markers[0]
    const position = marker.getPosition()
    mapRef.current.setCenter([position.lng, position.lat])
    mapRef.current.setZoom(18)
  }
}
```

## 使用场景

### 1. 城市选择器跳转
- 用户在城市选择器定位成功后
- 点击"查看地图"
- 显示我的位置（蓝色标记）
- 地图居中到我的位置

### 2. 充电站详情跳转
- 用户在充电站详情页面
- 点击"导航"按钮
- 显示充电站位置（红色标记）
- 同时获取并显示我的位置（蓝色标记）
- 地图自动调整视野显示两个位置

### 3. 手动定位
- 用户点击地图上的定位按钮
- 更新我的位置标记
- 保持充电站标记不变
- 重新调整地图视野

## 交互功能

### 地图点击
- 点击地图任意位置
- 自动设置为"我的位置"
- 更新蓝色标记位置
- 重新调整地图视野

### 搜索定位
- 输入地名搜索
- 搜索结果设置为"我的位置"
- 更新蓝色标记
- 重新调整地图视野

### 自动定位
- 使用GPS获取当前位置
- 设置为"我的位置"
- 更新蓝色标记
- 重新调整地图视野

## 样式特点

### 标记设计
- 3D立体效果
- 渐变色彩
- 白色边框
- 阴影效果
- 悬停动画

### 信息卡片
- 圆角设计
- 阴影效果
- 清晰的信息层次
- 响应式布局

## 兼容性
- 支持 Taro 环境
- 支持 H5 环境
- 自动检测环境
- 降级处理

## 注意事项
1. 两个标记使用不同的 zIndex 确保层级正确
2. 地图视野自动调整避免标记重叠
3. 标记更新时会自动重新计算视野
4. 支持动态添加和移除标记
