# 充电站详情页面导航功能说明

## 功能概述

充电站详情页面的导航功能可以让用户点击导航按钮后，自动跳转到手机上的地图软件（如高德地图、百度地图等），实现一键导航到充电站。

## 支持的导航方式

### 1. 原生导航API（优先）
- **Taro.openLocation** - 在支持的环境中直接调用系统地图
- **微信小程序 wx.openLocation** - 在微信环境中调用微信地图

### 2. 第三方地图应用
- **高德地图** - 支持路线规划和导航
- **百度地图** - 支持路线规划和导航
- **腾讯地图** - 支持路线规划和导航

## 工作流程

1. **用户点击导航按钮**
2. **系统尝试使用原生导航API**
3. **如果原生API不可用，显示地图选择器**
4. **用户选择地图应用**
5. **系统尝试打开选中的地图应用**
6. **如果应用打开失败，在浏览器中打开地图**

## 技术实现

### 核心函数

#### `handleNavigate()`
- 主要的导航处理函数
- 优先使用Taro.openLocation
- 失败时降级到通用地图链接

#### `openMapWithUniversalLink()`
- 构建各种地图应用的URL
- 支持高德、百度、腾讯、苹果、谷歌地图
- 处理微信小程序环境

#### `showMapSelector()`
- 显示地图应用选择器
- 使用Taro.showActionSheet或浏览器prompt
- 让用户选择偏好的地图应用

#### `openMapInBrowser()`
- 在浏览器中打开地图
- 支持新窗口和当前窗口打开
- 处理弹窗被阻止的情况

#### `showCoordinateInfo()`
- 最后的备选方案
- 显示充电站坐标信息
- 让用户手动复制坐标

### 地图应用URL格式

#### 高德地图
```
amapuri://route/plan/?sid=BGVIS1&slat=&slon=&sname=我的位置&did=BGVIS2&dlat=${lat}&dlon=${lng}&dname=${name}&dev=0&t=0
```

#### 百度地图
```
baidumap://map/direction?destination=latlng:${lat},${lng}|name:${name}&mode=driving&region=${address}
```

#### 腾讯地图
```
qqmap://map/routeplan?type=drive&to=${name}&tocoord=${lat},${lng}&referer=myapp
```



## 使用场景

### 1. 移动端应用
- 用户点击导航按钮
- 系统自动调用手机上的地图应用
- 支持多种地图应用选择

### 2. 微信小程序
- 使用微信的openLocation API
- 在微信环境中提供最佳体验

### 3. 浏览器环境
- 降级到浏览器打开地图
- 支持各种地图应用的网页版

### 4. 开发测试
- 提供完整的降级方案
- 确保在各种环境下都能正常工作

## 错误处理

### 1. 原生API失败
- 自动降级到通用地图链接
- 显示地图应用选择器

### 2. 地图应用打开失败
- 在浏览器中打开地图
- 显示坐标信息供用户手动操作

### 3. 网络问题
- 提供离线坐标信息
- 支持手动复制坐标

## 用户体验优化

### 1. 智能降级
- 优先使用最佳体验的原生API
- 逐步降级确保功能可用

### 2. 用户选择
- 提供地图应用选择器
- 尊重用户的偏好设置

### 3. 反馈提示
- 成功时显示确认提示
- 失败时提供解决方案

### 4. 多语言支持
- 支持中文地图应用
- 专注国内地图服务

## 注意事项

1. **权限要求** - 需要位置权限才能正常导航
2. **应用安装** - 用户需要安装相应的地图应用
3. **网络连接** - 在线地图需要网络连接
4. **平台兼容** - 专注国内主流地图应用
5. **用户体验** - 优先使用用户已安装的地图应用

## 扩展功能

### 1. 导航模式选择
- 驾车导航
- 步行导航
- 公交导航
- 骑行导航

### 2. 路线偏好设置
- 最短距离
- 最快时间
- 避开收费路段
- 避开高速路段

### 3. 实时路况
- 显示当前路况
- 预计到达时间
- 路况提醒

### 4. 收藏功能
- 收藏常用充电站
- 快速导航到收藏站点
