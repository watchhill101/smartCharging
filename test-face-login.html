<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äººè„¸ç™»å½•åŠŸèƒ½æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }

    .test-info {
      background: #f0f8ff;
      border: 1px solid #b6d7ff;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .test-info h3 {
      margin-top: 0;
      color: #1976d2;
    }

    .test-info ul {
      margin: 10px 0;
      padding-left: 20px;
    }

    .test-info li {
      margin: 5px 0;
    }

    .status {
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      font-weight: bold;
    }

    .status.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .status.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .status.info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }

    #console-output {
      background: #1e1e1e;
      color: #ffffff;
      padding: 15px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸ¯ äººè„¸ç™»å½•åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-info">
      <h3>æµ‹è¯•è¯´æ˜</h3>
      <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•ä¿®å¤åçš„äººè„¸ç™»å½•åŠŸèƒ½ã€‚ä¸»è¦ä¿®å¤çš„é—®é¢˜åŒ…æ‹¬ï¼š</p>
      <ul>
        <li>âœ… ä¿®å¤æ‘„åƒå¤´è§†é¢‘æµæœªæ‰¾åˆ°çš„é—®é¢˜</li>
        <li>âœ… æ”¹å–„å¼‚æ­¥æ—¶åºå¤„ç†</li>
        <li>âœ… å¢å¼ºé”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ</li>
        <li>âœ… ä¼˜åŒ–DOMå…ƒç´ æ“ä½œå’Œèµ„æºç®¡ç†</li>
        <li>âœ… æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡º</li>
      </ul>
    </div>

    <div class="status info" id="test-status">
      â„¹ï¸ å‡†å¤‡å¼€å§‹æµ‹è¯•...è¯·ç¡®ä¿æµè§ˆå™¨æ”¯æŒæ‘„åƒå¤´è®¿é—®
    </div>

    <div id="console-output">
      === äººè„¸ç™»å½•æµ‹è¯•æ§åˆ¶å° ===
      ç­‰å¾…æµ‹è¯•å¼€å§‹...

      æµ‹è¯•æ­¥éª¤ï¼š
      1. æ£€æŸ¥æµè§ˆå™¨æ‘„åƒå¤´æ”¯æŒ
      2. è¯·æ±‚æ‘„åƒå¤´æƒé™
      3. åˆå§‹åŒ–è§†é¢‘æµ
      4. å¯åŠ¨äººè„¸æ£€æµ‹
      5. æ¨¡æ‹Ÿç™»å½•è¿‡ç¨‹

      è¯·åœ¨å‰ç«¯åº”ç”¨ä¸­è®¿é—®ç™»å½•é¡µé¢æˆ–äººè„¸ç™»å½•ç»„ä»¶è¿›è¡Œå®é™…æµ‹è¯•ã€‚
    </div>
  </div>

  <script>
    // æ¨¡æ‹Ÿæ§åˆ¶å°è¾“å‡º
    function addLog(message, type = 'info') {
      const output = document.getElementById('console-output');
      const timestamp = new Date().toLocaleTimeString();
      const emoji = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
      output.textContent += `\n[${timestamp}] ${emoji} ${message}`;
      output.scrollTop = output.scrollHeight;
    }

    // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
    function checkBrowserSupport() {
      addLog('å¼€å§‹æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ...');

      if (!navigator.mediaDevices) {
        addLog('æµè§ˆå™¨ä¸æ”¯æŒ MediaDevices API', 'error');
        updateStatus('error', 'âŒ æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½');
        return false;
      }

      if (!navigator.mediaDevices.getUserMedia) {
        addLog('æµè§ˆå™¨ä¸æ”¯æŒ getUserMedia API', 'error');
        updateStatus('error', 'âŒ æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´è®¿é—®');
        return false;
      }

      addLog('æµè§ˆå™¨æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½', 'success');
      return true;
    }

    // æµ‹è¯•æ‘„åƒå¤´æƒé™
    async function testCameraPermission() {
      try {
        addLog('æ­£åœ¨è¯·æ±‚æ‘„åƒå¤´æƒé™...');
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'user'
          }
        });

        addLog('æ‘„åƒå¤´æƒé™è·å–æˆåŠŸ', 'success');
        addLog(`è§†é¢‘è½¨é“æ•°é‡: ${stream.getVideoTracks().length}`);

        // åœæ­¢æµ‹è¯•æµ
        stream.getTracks().forEach(track => track.stop());

        updateStatus('success', 'âœ… æ‘„åƒå¤´åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥è¿›è¡Œäººè„¸ç™»å½•æµ‹è¯•');
        return true;

      } catch (error) {
        let errorMsg = 'æ‘„åƒå¤´æƒé™æµ‹è¯•å¤±è´¥';
        if (error.name === 'NotAllowedError') {
          errorMsg = 'ç”¨æˆ·æ‹’ç»äº†æ‘„åƒå¤´æƒé™';
        } else if (error.name === 'NotFoundError') {
          errorMsg = 'æœªæ‰¾åˆ°æ‘„åƒå¤´è®¾å¤‡';
        } else if (error.name === 'NotSupportedError') {
          errorMsg = 'æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´åŠŸèƒ½';
        }

        addLog(`${errorMsg}: ${error.message}`, 'error');
        updateStatus('error', `âŒ ${errorMsg}`);
        return false;
      }
    }

    function updateStatus(type, message) {
      const statusEl = document.getElementById('test-status');
      statusEl.className = `status ${type}`;
      statusEl.textContent = message;
    }

    // å¯åŠ¨æµ‹è¯•
    async function runTests() {
      addLog('=== å¼€å§‹äººè„¸ç™»å½•åŠŸèƒ½æµ‹è¯• ===');

      if (!checkBrowserSupport()) {
        return;
      }

      updateStatus('info', 'ğŸ”„ æ­£åœ¨æµ‹è¯•æ‘„åƒå¤´æƒé™...');
      await testCameraPermission();

      addLog('=== æµ‹è¯•å®Œæˆ ===');
      addLog('è¯·åœ¨å®é™…åº”ç”¨ä¸­æµ‹è¯•äººè„¸ç™»å½•ç»„ä»¶çš„å®Œæ•´åŠŸèƒ½');
    }

    // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
    window.addEventListener('load', () => {
      setTimeout(runTests, 1000);
    });
  </script>
</body>

</html>